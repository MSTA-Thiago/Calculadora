<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <title>Calculadora de Desconto no Mercado Livre de Energia</title>
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand">Calculadora de Desconto no Mercado Livre de Energia</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="https://energialivre.cemig.com.br/duvidas-frequentes/">Dúvidas?</a></li>
                <li><a href="http://calculadoramercadolivre.com.br/contato">Contato</a></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <form id="calc-form" method="POST">
            <div class="container">
                {{errors}}
                {{result}}
                <label>Entre com os dados</label>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="Conta"><br>Razão Social/ Nome:</label>
                            <input name="conta" type="text" class="form-control" id="Conta" aria-describedby="Conta" placeholder="Razão Social">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="CNPJ"><br>CNPJ/ CPF:</label>
                            <input name="cnpj" type="text" class="form-control" id="CNPJ" aria-describedby="CNPJ" placeholder="CNPJ">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="distribuidora">Empresa Distribuidora</label>
                            <select id="distribuidora" class="form-control" name="distribuidora">
                                <option selected>CEMIG-D</option>
                                <option>CPFL Jaguari</option>
                                <option>CEBDIS</option>
                                <option>Celesc-DIS</option>
                                <option>CELPE</option>
                                <option>CEMIG PSR</option>
                                <option>COELBA</option>
                                <option>COPEL</option>
                                <option>COSERN</option>
                                <option>CPFL-Paulista</option>
                                <option>EDP ES</option>
                                <option>Enel CE</option>
                                <option>Enel GO</option>
                                <option>Enel SP</option>
                                <option>ENERGISA MS</option>
                                <option>ENERGISA MT</option>
                                <option>ENERGISA PB</option>
                                <option>EQUATORIAL PA</option>
                                <option>LIGHT</option>
                                <option>Elektro (Experimental)</option>
                                <option>Enel RJ  (Experimental)</option>
                                <option>Enel SP  (Experimental)</option>
                                <option>EMG  (Experimental)</option>
                                <option>AmE  (Experimental)</option>
                                <option>CEEE-D  (Experimental)</option>
                                <option>ENERGISA TO  (Experimental)</option>
                                <option>RGE Sul  (Experimental)</option>
                                <option>CPFL Leste Paulista</option>
                                <option>CPFL Mococa</option>
                                <option>CPFL Santa Cruz</option>
                                <option>CPFL Sul Paulista</option>
                                <option>EBO</option>
                                <option>ELFSM</option>
                                <option>CERIPA</option>
                                <option>ENEL RJ</option>
                                <option>CERES</option>
                                <option>EFLJC</option>
                                <option>EFLUL</option>
                                <option>CPFL-PAULISTA</option>
                                <option>EMS</option>
                                <option>CERPRO</option>
                                <option>CERRP</option>
                                <option>RGE SUL</option>
                                <option>UHENPAL</option>
                                <option>COSERN</option>
                                <option>ENEL CE</option>
                                <option>ESE</option>
                                <option>CERTAJA</option>
                                <option>EPB</option>
                                <option>CELPE</option>
                                <option>CERCOS</option>
                                <option>CNEE</option>
                                <option>EDEVP</option>
                                <option>EEB</option>
                                <option>ESS</option>
                                <option>CERNHE</option>
                                <option>EMR</option>
                                <option>ENF</option>
                                <option>RGE</option>
                                <option>COCEL</option>
                                <option>COPEL-DIS</option>
                                <option>DMED</option>
                                <option>CFLO</option>
                                <option>DEMEI</option>
                                <option>ELETROCAR</option>
                                <option>HIDROPAN</option>
                                <option>MUXENERGIA</option>
                                <option>CERAL ARAPOTI</option>
                                <option>ELETROPAULO</option>
                                <option>ETO</option>
                                <option>CERIS</option>
                                <option>EMT</option>
                                <option>CELESC-DIS</option>
                                <option>DCELT</option>
                                <option>EDP ES</option>
                                <option>Equatorial PA</option>
                                <option>COOPERALIANÇA</option>
                                <option>PACTO ENERGIA PR</option>
                                <option>ELEKTRO</option>
                                <option>Equatorial AL</option>
                                <option>Equatorial MA</option>
                                <option>Equatorial PI</option>
                                <option>CEDRAP</option>
                                <option>CEDRI</option>
                                <option>CHESP</option>
                                <option>Equatorial GO</option>
                                <option>CEJAMA</option>
                                <option>CERAÇÁ</option>
                                <option>CERAL ANITÁPOLIS</option>
                                <option>CERBRANORTE</option>
                                <option>CEREJ</option>
                                <option>CERGAL</option>
                                <option>CERGRAL</option>
                                <option>CERPALO</option>
                                <option>CERSUL</option>
                                <option>COOPERA</option>
                                <option>COOPERMILA</option>
                                <option>COORSEL</option>
                                <option>CPFL- PIRATININGA</option>
                                <option>EDP SP</option>
                                <option>CEEE-D</option>
                                <option>CERIM</option>
                                <option>CERMC</option>
                                <option>CETRIL</option>
                                <option>AME</option>
                                <option>Boa Vista</option>
                                <option>CERR</option>
                                <option>LIGHT</option>
                                <option>CERON</option>
                                <option>ELETROACRE</option>
                                <option>SULGIPE</option>
                                <option>CERTEL ENERGIA</option>
                                <option>CERILUZ</option>
                                <option>CERMISSÕES</option>
                                <option>COOPERLUZ</option>
                                <option>COPREL</option>
                                <option>CRELUZ-D</option>
                                <option>CRERAL</option>
                                <option>CEPRAG</option>
                                <option>CERGAPA</option>
                                <option>CERMOFUL</option>
                                <option>CERTREL</option>
                                <option>COOPERCOCAL</option>
                                <option>CEA</option>
                                <option>CERCI</option>
                                <option>CASTRO - DIS</option>
                                <option>CERAL ARARUAMA</option>
                                <option>CERFOX</option>
                                <option>CERTHIL</option>
                                <option>CEGERO</option>
                                <option>CERSAD DISTRIBUIDORA</option>
                                <option>COOPERZEM</option>
                                <option>CERVAM</option>
                                <option>CODESAM</option>
                                <option>COOPERNORTE</option>
                                <option>COOPERSUL</option>
                                <option>CEMIRIM</option>
                                <option>CELETRO</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="subgrupo">Subgrupo</label>
                            <select id="subgrupo" class="form-control" name="subgrupo">
                                <option selected>A2</option>
                                <option>A3</option>
                                <option>A3a</option>
                                <option>A4</option>
                                <option>AS</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="InputModal">Modalidade Tarifária</label>
                            <select id="InputModal" class="form-control" name="InputModal">
                                <option selected>Azul</option>
                                <option>Verde</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="energia">Modalidade Tarifária</label>
                            <select id="energia" class="form-control" name="energia">
                                <option selected>Convencional</option>
                                <option>Energia convencional especial (I0)</option>
                                <option>Energia incentivada especial (I5)</option>
                                <option>Energia incentivada especial (I1)</option>
                                <option>Energia incentivada especial (I8)</option>
                                <option>Energia incentivada não especial (CQ5)</option>
                                <option>Energia incentivada não especial (CQ1)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="InputDemandaHP">Digite a demanda HP:</label>
                            <input name="InputDemandaHP" type="number" class="form-control" id="InputDemandaHP" aria-describedby="InputDemandaHP" placeholder="em kW">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="InputDemandaHFP">Digite a demanda HFP:</label>
                            <input name="InputDemandaHFP" type="number" class="form-control" id="InputDemandaHFP" aria-describedby="InputDemandaHFP" placeholder="em kW">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="InputConsumoHP">Digite o consumo HP:</label>
                            <input name="InputConsumoHP" type="number" class="form-control" id="InputConsumoHP" aria-describedby="InputConsumoHP" placeholder="em kW">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="InputConsumoHFP">Digite o consumo HFP:</label>
                            <input name="InputConsumoHFP" type="number" class="form-control" id="InputConsumoHFP" aria-describedby="InputConsumoHFP" placeholder="em kW">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="ICMS">ICMS: (%)</label>
                            <input name="ICMS" type="number" class="form-control" id="ICMS" aria-describedby="ICMS" placeholder="em %" >
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="PASEP">PIS/PASEP: (%)</label>
                            <input name="PASEP" type="number" class="form-control" id="PASEP" aria-describedby="PASEP" placeholder="em %" >
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label for="COFINS">COFINS: (%)</label>
                            <input name="COFINS" type="number" class="form-control" id="COFINS" aria-describedby="COFINS" placeholder="em %">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="preco_pm">Para cálculo do desconto, informe o preço obtido:</label>
                            <input name="preco_pm" type="number" class="form-control" id="preco_pm" aria-describedby="preco_pm" placeholder="em R$">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="certificadpR">Há certificado de energia renovável, se sim, coloque o custo: (R$/MWh)</label>
                            <input name="certificadpR" type="number" class="form-control" id="certificadpR" aria-describedby="certificadpR" placeholder="em R$" value="0">
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Calcular</button>
<!--                <a href="http://calculadoramercadolivre.com.br/metodologia">Deseja entender a Metodologia?</a>-->
            </div>
        </form>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3>Resultado:</h3>
                <textarea id="resultado" class="form-control" rows="5" readonly></textarea>
            </div>
        </div>
    </div>
</body>
<script>
    document.getElementById('calc-form').addEventListener('submit', function(event) {
        event.preventDefault();

        var formData = new FormData(document.getElementById('calc-form'));

        fetch('/simulacao-preco', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(result => {
            document.getElementById('resultado').value = result;

            // Solicitação POST para /gerar_pdf
            fetch('/gerar_pdf', {
                method: 'POST',
                body: formData
            })
            .then(response => response.blob()) // Processa a resposta como um objeto Blob
            .then(blob => {
                // Cria um objeto URL temporário para o Blob
                const url = window.URL.createObjectURL(blob);
                // Cria um link temporário
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                // Define o nome do arquivo a ser baixado
                a.download = 'resultado.pdf';
                // Anexa o link ao corpo do documento
                document.body.appendChild(a);
                // Clica no link para iniciar o download
                a.click();
                // Remove o link do corpo do documento
                document.body.removeChild(a);
                // Revoga o URL do objeto Blob, liberando os recursos
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Erro ao gerar o PDF:', error);
            });

        })
        .catch(error => {
            console.error('Erro:', error);
        });
    });
</script>
</html>
